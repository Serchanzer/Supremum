#include <SoftwareSerial.h>
#define MOT_A1_PIN 5
#define MOT_A2_PIN 6
#define MOT_A3_PIN 7
#define MOT_A4_PIN 8
SoftwareSerial mySerial(10, 9); // RX, TX
int pwm=0;
void setup() {
  // Open serial communications and wait for port to open:
    Serial.begin(9600);
  while (!Serial) {
    ; // wait for serial port to connect. Needed for native USB port only
  }
  // set the data rate for the SoftwareSerial port
  mySerial.begin(9600);
  pinMode(MOT_A1_PIN, OUTPUT);
  pinMode(MOT_A2_PIN, OUTPUT);
  pinMode(MOT_A3_PIN, OUTPUT);
  pinMode(MOT_A4_PIN, OUTPUT);
  // Start with drivers off, motors coasting.
  digitalWrite(MOT_A1_PIN, LOW);
  digitalWrite(MOT_A2_PIN, LOW);
  digitalWrite(MOT_A3_PIN, LOW);
  digitalWrite(MOT_A4_PIN, LOW);
void loop() { // run over and over
  if (mySerial.available()) {
    char data = mySerial.read();
    Serial.println(data);
    switch (data) {
      case '1':
        if(pwm<255) {
          pwm+=15;
          forward(pwm);//Увеличить скорость по направлению вперёд
        }
        break;
      case '2':
      if(pwm>-255) {
        pwm-=15;
        forward(pwm);//Уменьшить скорость по направлению вперёд
      }
        break;
      case '3':
        while(pwm!=0){ //Плавно снижаем скорость до 0
          if(pwm>0) pwm-=15;
          if(pwm<0) pwm+=15;
          delay(100);
        }
        pwm+=90;
        right(pwm);//Поворот направо
        break;
      case '4':
        while(pwm!=0){ //Плавно снижаем скорость до 0
          if(pwm>0) pwm-=15;
          if(pwm<0) pwm+=15;
          delay(100);
        }
        pwm+=90;
        left(pwm);//Поворот налево
        break;
    }
    delay(20);
  }
  else {
    if(pwm>0) pwm-=15;
    if(pwm<0) pwm+=15;
    delay(20);
  }
  
}

void forward(int pwm){
  if (pwm > 0) {
    analogWrite(MOT_A1_PIN , pwm);
    digitalWrite(MOT_A2_PIN, LOW);
    analogWrite(MOT_A3_PIN , pwm);
    digitalWrite(MOT_A4_PIN, LOW);
  }
  else {
    analogWrite(MOT_A1_PIN, 255+pwm);
    digitalWrite(MOT_A2_PIN, HIGH);
    analogWrite(MOT_A3_PIN, 255+pwm);
    digitalWrite(MOT_A4_PIN, HIGH);
  }
  
}

void right(int pwm){
  analogWrite(MOT_A1_PIN , pwm);
  digitalWrite(MOT_A2_PIN, LOW);
  analogWrite(MOT_A3_PIN, 255+pwm);
  digitalWrite(MOT_A4_PIN, HIGH);
  
}

void left(int pwm){
  analogWrite(MOT_A1_PIN, 255+pwm);
  digitalWrite(MOT_A2_PIN, HIGH);
  analogWrite(MOT_A3_PIN , pwm);
  digitalWrite(MOT_A4_PIN, LOW);

  
}