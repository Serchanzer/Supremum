#include <SoftwareSerial.h>
#define MOT_A1_PIN 1
#define MOT_A2_PIN 2
#define MOT_A3_PIN 3
#define MOT_A4_PIN 4
#define MOT_A5_PIN 5
#define MOT_A6_PIN 6
#define MOT_A7_PIN 7
#define MOT_A8_PIN 8
#define MOT_A9_PIN 9
#define MOT_A10_PIN 10
#define MOT_A11_PIN 11
#define MOT_A12_PIN 12
SoftwareSerial mySerial(10, 9); // RX, TX
int pwm=0;
void setup() {
  // Open serial communications and wait for port to open:
    Serial.begin(9600);
  while (!Serial) {
    ; // wait for serial port to connect. Needed for native USB port only
  }
  // set the data rate for the SoftwareSerial port
  mySerial.begin(9600);
  pinMode(MOT_A1_PIN, OUTPUT);
  pinMode(MOT_A2_PIN, OUTPUT);
  pinMode(MOT_A3_PIN, OUTPUT);
  pinMode(MOT_A4_PIN, OUTPUT);
  pinMode(MOT_A5_PIN, OUTPUT);
  pinMode(MOT_A6_PIN, OUTPUT);
  pinMode(MOT_A7_PIN, OUTPUT);
  pinMode(MOT_A8_PIN, OUTPUT);
  pinMode(MOT_A9_PIN, OUTPUT);
  pinMode(MOT_A10_PIN, OUTPUT);
  pinMode(MOT_A11_PIN, OUTPUT);
  pinMode(MOT_A12_PIN, OUTPUT);
  // Start with drivers off, motors coasting.
  digitalWrite(MOT_A1_PIN, LOW);
  digitalWrite(MOT_A2_PIN, LOW);
  digitalWrite(MOT_A3_PIN, LOW);
  digitalWrite(MOT_A4_PIN, LOW);
  digitalWrite(MOT_A5_PIN, LOW);
  digitalWrite(MOT_A6_PIN, LOW);
  digitalWrite(MOT_A7_PIN, LOW);
  digitalWrite(MOT_A8_PIN, LOW);
  digitalWrite(MOT_A9_PIN, LOW);
  digitalWrite(MOT_A10_PIN, LOW);
  digitalWrite(MOT_A11_PIN, LOW);
  digitalWrite(MOT_A12_PIN, LOW);

}

void loop() { // run over and over
  if (mySerial.available()) {
    char data = mySerial.read();
    Serial.println(data);
    switch (data) {
      case '1':
        if(pwm<255) {
          pwm+=15;
          forward(pwm, MOT_A1_PIN, MOT_A2_PIN, MOT_A3_PIN, MOT_A4_PIN);
          forward(pwm, MOT_A5_PIN, MOT_A6_PIN, MOT_A7_PIN, MOT_A8_PIN);
          forward(pwm, MOT_A9_PIN, MOT_A10_PIN, MOT_A11_PIN, MOT_A12_PIN);//Увеличить скорость по направлению вперёд
        }
        break;
      case '2':
      if(pwm>-255) {
        pwm-=15;
          forward(pwm, MOT_A1_PIN, MOT_A2_PIN, MOT_A3_PIN, MOT_A4_PIN);
          forward(pwm, MOT_A5_PIN, MOT_A6_PIN, MOT_A7_PIN, MOT_A8_PIN);
          forward(pwm, MOT_A9_PIN, MOT_A10_PIN, MOT_A11_PIN, MOT_A12_PIN);//Уменьшить скорость по направлению вперёд
      }
        break;
      case '3':
        pwm=90;
          right(pwm, MOT_A1_PIN, MOT_A2_PIN, MOT_A3_PIN, MOT_A4_PIN);
          right(pwm, MOT_A5_PIN, MOT_A6_PIN, MOT_A7_PIN, MOT_A8_PIN);
          right(pwm, MOT_A9_PIN, MOT_A10_PIN, MOT_A11_PIN, MOT_A12_PIN);//Поворот направо
        break;
      case '4':
        pwm=90;
          left(pwm, MOT_A1_PIN, MOT_A2_PIN, MOT_A3_PIN, MOT_A4_PIN);
          left(pwm, MOT_A5_PIN, MOT_A6_PIN, MOT_A7_PIN, MOT_A8_PIN);
          left(pwm, MOT_A9_PIN, MOT_A10_PIN, MOT_A11_PIN, MOT_A12_PIN);//Поворот налево
        break;
    }
    delay(20);
  }
  
}
void forward(int pwm, int A1, int A2, int A3, int A4){ // Два пина от 2-х моторов
  
  if (pwm > 0) {
    digitalWrite(A1, LOW);
    analogWrite(A2, pwm);
    digitalWrite(A3, LOW);
    analogWrite(A4, pwm);
  }
  else {
    analogWrite(A1, -pwm);
    digitalWrite(A2, LOW);
    analogWrite(A3, -pwm);
    digitalWrite(A4, LOW);
  }
  
}
void right(int pwm, int A1, int A2, int A3, int A4){

    digitalWrite(A1, LOW);
    analogWrite(A2 , pwm);
    digitalWrite(A4, LOW);
    analogWrite(A3, pwm);

}
void left(int pwm, int A1, int A2, int A3, int A4){

    digitalWrite(A2, LOW);
    analogWrite(A1 , pwm);
    digitalWrite(A3, LOW);
    analogWrite(A4 , pwm);

}